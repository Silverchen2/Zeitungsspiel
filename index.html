<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zeitung fangen!</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: radial-gradient(ellipse at center, rgba(100, 120, 180, 0.2), rgba(30, 30, 60, 0.3));
      overflow: hidden;
      color: white;
    }
    #spielbereich {
      position: relative;
      width: 600px;
      height: 400px;
      overflow: hidden;
      margin: 40px auto;
      border: 2px solid white;
      border-radius: 10px;
      background: radial-gradient(ellipse at center, rgba(100, 120, 180, 0.2), rgba(30, 30, 60, 0.15));
    }
    #startscreen {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 50, 0.6);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 2;
    }
    #startscreen h1 {
      font-size: 28px;
      margin-bottom: 20px;
      max-width: 80%;
    }
    #startbutton, #restartbutton {
      padding: 12px 24px;
      font-size: 18px;
      background-color: white;
      color: black;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    #spieler {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 48px;
      pointer-events: none;
      user-select: none;
    }
    .zeitung {
      position: absolute;
      top: -50px;
      font-size: 36px;
      pointer-events: none;
      user-select: none;
    }
    #punkte, #leben {
      position: absolute;
      top: 10px;
      font-size: 20px;
      font-weight: bold;
      user-select: none;
    }
    #punkte {
      left: 10px;
    }
    #leben {
      right: 10px;
    }
    #gameover {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      font-weight: bold;
      background-color: rgba(255,255,255,0.95);
      color: black;
      padding: 20px;
      border: 2px solid black;
      border-radius: 8px;
      display: none;
      z-index: 3;
      text-align: center;
      user-select: none;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
    }
    #rangliste {
      margin-top: 10px;
      color: black;
      text-align: left;
    }
    #rangliste ol {
      padding-left: 20px;
      margin: 0;
    }
  </style>
</head>
<body>
  <div id="spielbereich">
    <div id="startscreen">
      <h1>Hilf uns die Zeitungen aufzufangen,<br>bevor sie alle weggeweht werden!</h1>
      <button id="startbutton">Los geht‚Äôs!</button>
    </div>

    <div id="spieler" style="display: none;">üß∫</div>
    <div id="punkte" style="display: none;">Punkte: 0</div>
    <div id="leben" style="display: none;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div id="gameover">
      <div>Spiel vorbei!<br>Punkte: <span id="endstand"></span></div>
      <div id="rangliste"><strong>Top 5 Spieler:innen:</strong><ol></ol></div>
      <button id="restartbutton">Erneut spielen</button>
    </div>
  </div>

<script>
  const spielbereich = document.getElementById("spielbereich");
  const spieler = document.getElementById("spieler");
  const punkteAnzeige = document.getElementById("punkte");
  const lebenAnzeige = document.getElementById("leben");
  const gameoverAnzeige = document.getElementById("gameover");
  const endstand = document.getElementById("endstand");
  const startscreen = document.getElementById("startscreen");
  const startbutton = document.getElementById("startbutton");
  const restartbutton = document.getElementById("restartbutton");
  const ranglisteOl = document.querySelector("#rangliste ol");

  // Dein Google Apps Script URL:
  const googleScriptURL = "https://script.google.com/macros/s/AKfycbzrSuWG5K_ayANKdtrXztYh_piK-wvfWO1v0dAXn6lVCYeMhguBI2bAT48b_uckWCM4/exec";

  let punkte = 0;
  let leben = 3;
  let geschwindigkeit = 4;
  let spawnRate = 800;
  let spieleAktiv = false;

  // Zuf√§lliger Name-Generator (f√ºr Score-Eintr√§ge)
  function generiereNamen() {
    const adjektive = [
      "Flinke", "Listige", "Lautlose", "Rasende", "Neugierige", "Schn√ºffelnde", "Unerm√ºdliche", "Tippende",
      "Wachsame", "Geheime", "Eilige", "Witzige", "Smarte", "Taktische", "Wilde", "Schlaue", "Mutige", "Verschnupfte",
      "Tintenreiche", "Verwirrte", "Nostalgische", "Retrohafte", "Analoge", "Digitale", "Kritische", "Gewitzte"
    ];
    const namen = [
      "Zeitungskatze", "Druckteufel", "Blattlaus", "Nachrichtengeist", "Spaltengeist", "Zeilenfuchs", "Tintenmolch",
      "Presseeule", "Kolumnenkobold", "Layoutgeist", "Schlagzeilenhai", "Artikelkrake", "Textritter",
      "Anzeigenwichtel", "Druckdrache", "Redaktionskrabbe", "Lesemurmeltier", "Papiergeist", "Headlinehase",
      "Formatferkel", "Satzspinne", "Archivgnom", "Rollenhamster"
    ];
    const zahl = Math.floor(Math.random() * 100);
    return `${adjektive[Math.floor(Math.random() * adjektive.length)]}${namen[Math.floor(Math.random() * namen.length)]}${zahl}`;
  }

  document.addEventListener("mousemove", (e) => {
    if (!spieleAktiv) return;
    const rect = spielbereich.getBoundingClientRect();
    let x = e.clientX - rect.left;
    x = Math.max(0, Math.min(x, rect.width));
    spieler.style.left = x + "px";
  });

  function updateLeben() {
    lebenAnzeige.textContent = "‚ù§Ô∏è".repeat(leben);
  }

  function erstelleZeitung() {
    if (!spieleAktiv) return;
    const zeitung = document.createElement("div");
    zeitung.classList.add("zeitung");
    zeitung.textContent = "üóûÔ∏è";
    zeitung.style.left = Math.random() * (spielbereich.clientWidth - 40) + "px";
    spielbereich.appendChild(zeitung);

    let pos = -50;
    const fallIntervall = setInterval(() => {
      if (!spieleAktiv) {
        zeitung.remove();
        clearInterval(fallIntervall);
        return;
      }
      pos += geschwindigkeit;
      zeitung.style.top = pos + "px";

      const zeitungRect = zeitung.getBoundingClientRect();
      const spielerRect = spieler.getBoundingClientRect();

      if (
        zeitungRect.bottom >= spielerRect.top &&
        zeitungRect.left < spielerRect.right &&
        zeitungRect.right > spielerRect.left
      ) {
        punkte++;
        punkteAnzeige.textContent = "Punkte: " + punkte;
        zeitung.remove();
        clearInterval(fallIntervall);
        geschwindigkeit += 0.25;
        if (spawnRate > 200) spawnRate -= 10;
      }

      if (pos > spielbereich.clientHeight) {
        zeitung.remove();
        clearInterval(fallIntervall);
        leben--;
        updateLeben();
        if (leben <= 0) {
          spielBeenden();
        }
      }
    }, 20);
  }

  function spawnLoop() {
    if (!spieleAktiv) return;
    let maxZeitungen = Math.min(1 + Math.floor(punkte / 1), 1);
    const anzahl = Math.floor(Math.random() * maxZeitungen) + 1;
    for (let i = 0; i < anzahl; i++) {
      erstelleZeitung();
    }
    setTimeout(spawnLoop, spawnRate);
  }

  function startSpiel() {
    spieleAktiv = true;
    punkte = 0;
    leben = 3;
    geschwindigkeit = 4;
    spawnRate = 800;
    punkteAnzeige.textContent = "Punkte: 0";
    updateLeben();
    gameoverAnzeige.style.display = "none";
    spawnLoop();
  }

  // Highscore laden von Google Script
  async function ladeRangliste() {
    try {
      const res = await fetch(googleScriptURL);
      if (!res.ok) throw new Error("Fehler beim Laden der Rangliste");
      const daten = await res.json();
      return daten.sort((a, b) => b.score - a.score).slice(0, 5);
    } catch (e) {
      console.error(e);
      return [];
    }
  }

  // Highscore speichern via Google Script
  async function speichereScore(score) {
    const name = generiereNamen();
    try {
      await fetch(googleScriptURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, score })
      });
    } catch (e) {
      console.error("Fehler beim Speichern:", e);
    }
  }

  async function zeigeRangliste() {
    const daten = await ladeRangliste();
    if (daten.length === 0) {
      ranglisteOl.innerHTML = "<li>Keine Eintr√§ge</li>";
      return;
    }
    ranglisteOl.innerHTML = daten
      .map(e => `<li>${e.name}: ${e.score} Punkte</li>`)
      .join("");
  }

  async function spielBeenden() {
    spieleAktiv = false;
    punkteAnzeige.textContent = "Punkte: " + punkte;
    endstand.textContent = punkte;
    gameoverAnzeige.style.display = "block";
    await speichereScore(punkte);
    await zeigeRangliste();
  }

  startbutton

